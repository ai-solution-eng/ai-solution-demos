{"data":{"edges":[],"nodes":[{"data":{"id":"flightpassenger-dhFpE","node":{"base_classes":["Data"],"beta":false,"conditional_paths":[],"custom_fields":{},"description":"Use this tool to look up passenger flight information. The possible columns to match are name and/or flight if provided.","display_name":"EzPresto tool","documentation":"https://docs.langflow.org/components-custom-components","edited":true,"field_order":["user_password","database_name","schema_name","table_name","sql_query","global_imports","sql_query_code"],"frozen":false,"icon":"code","last_updated":"2025-09-26T07:13:09.678Z","legacy":false,"lf_version":"1.5.1","metadata":{},"minimized":false,"official":false,"output_types":[],"outputs":[{"types":["Tool"],"selected":"Tool","name":"component_as_tool","hidden":null,"display_name":"Toolset","method":"to_toolkit","value":"__UNDEFINED__","cache":true,"required_inputs":null,"allows_loop":false,"group_outputs":false,"options":null,"tool_mode":true}],"pinned":false,"template":{"_type":"Component","code":{"advanced":true,"dynamic":true,"fileTypes":[],"file_path":"","info":"","list":false,"load_from_db":false,"multiline":true,"name":"code","password":false,"placeholder":"","required":true,"show":true,"title_case":false,"type":"code","value":"import re\nimport importlib\n\nfrom langchain_experimental.utilities import PythonREPL\n\nfrom langflow.custom import Component\nfrom langflow.io import MessageTextInput, CodeInput, Output, StrInput\nfrom langchain_core.tools import StructuredTool, Tool\nfrom langflow.schema import Data\n\n\nclass CustomComponent(Component):\n    display_name = \"EzPresto tool\"\n    description = \"Use this tool to look up passenger flight information. The possible columns to match are name and/or flight if provided.\"\n    documentation: str = \"https://docs.langflow.org/components-custom-components\"\n    icon = \"code\"\n    name = \"flightpassenger\"\n\n    inputs = [\n        SecretStrInput(\n            name=\"user_password\",\n            display_name=\"User Token\",\n            info=\"The user token to authorize the SQL query.\",\n            advanced=True,\n            value=\"\",\n            required=True,\n        ),\n        MessageTextInput(\n            name=\"database_name\",\n            display_name=\"DB Name\",\n            info=\"This is the name of the database in PCAI\",\n            value=\"fakecustomerinfo\",\n            tool_mode=False,\n        ),\n        MessageTextInput(\n            name=\"schema_name\",\n            display_name=\"Schema Name\",\n            info=\"This is the name of the schema for the database in PCAI\",\n            value=\"default\",\n            tool_mode=False,\n        ),\n        MessageTextInput(\n            name=\"table_name\",\n            display_name=\"Table Name\",\n            info=\"This is the name of the table within the schema for the database in PCAI\",\n            value=\"fake_customer_data\",\n            tool_mode=False,\n        ),\n        MessageTextInput(\n            name=\"sql_query\",\n            display_name=\"SQL Query\",\n            info=\"This is the SQL query which will be run on the specified database in PCAI. The columns to match are name and flight.\",\n            value=\"SELECT * FROM fake_customer_data\",\n            tool_mode=True,\n        ),\n        StrInput(\n            name=\"global_imports\",\n            display_name=\"Global Imports\",\n            info=\"A comma-separated list of modules to import globally, e.g. 'math,numpy,pandas'.\",\n            value=\"json,request,time\",\n            advanced=True,\n            required=True,\n        ),\n        CodeInput(\n            name=\"sql_query_code\",\n            display_name=\"SQL Code\",\n            info=\"The SQL code to execute.\",\n            value=\"print('Hello, World!')\",\n            tool_mode=False,\n            advanced=True,\n            required=True,\n        ),\n    ]\n\n    outputs = [\n        Output(\n            display_name=\"Results\",\n            name=\"results\",\n            type_=Data,\n            method=\"flightpassenger\",\n        ),\n    ]\n\n    def get_globals(self, global_imports: str | list[str]) -> dict:\n        \"\"\"Create a globals dictionary with only the specified allowed imports.\"\"\"\n        global_dict = {}\n\n        try:\n            if isinstance(global_imports, str):\n                modules = [module.strip() for module in global_imports.split(\",\")]\n            elif isinstance(global_imports, list):\n                modules = global_imports\n            else:\n                msg = \"global_imports must be either a string or a list\"\n                raise TypeError(msg)\n\n            for module in modules:\n                try:\n                    imported_module = importlib.import_module(module)\n                    global_dict[imported_module.__name__] = imported_module\n                except ImportError as e:\n                    msg = f\"Could not import module {module}: {e!s}\"\n                    raise ImportError(msg) from e\n\n        except Exception as e:\n            self.log(f\"Error in global imports: {e!s}\")\n            raise\n        else:\n            self.log(f\"Successfully imported modules: {list(global_dict.keys())}\")\n            return global_dict\n\n    def flightpassenger(self) -> Data:\n        try:\n            python_repl = PythonREPL()\n            new_sql_query_code = re.sub('(?<=catalog = ).+', f'\"{self.database_name}\"', self.sql_query_code)\n            new_sql_query_code = re.sub('(?<=schema = ).+', f'\"{self.schema_name}\"', new_sql_query_code)\n            new_sql_query_code = re.sub(r'(?<=FROM )\\w+', f'{self.table_name}', new_sql_query_code)\n            if 'WHERE' in self.sql_query:\n                filter_sql_query = self.sql_query.split('WHERE')[-1]\n                new_sql_query_code = re.sub(f'(?<=FROM {self.table_name})', f' WHERE {filter_sql_query}', new_sql_query_code)\n            new_sql_query_code = re.sub('auth_token = \"\"', f'auth_token = \"{self.user_password}\"', new_sql_query_code)\n            \n            result = python_repl.run(new_sql_query_code)\n            result = result.strip() if result else \"\"\n\n            self.log(\"Code execution completed successfully\")\n            return Data(data={\"result\": result})\n\n        except ImportError as e:\n            error_message = f\"Import Error: {e!s}\"\n            self.log(error_message)\n            return Data(data={\"error\": error_message})\n\n        except SyntaxError as e:\n            error_message = f\"Syntax Error: {e!s}\"\n            self.log(error_message)\n            return Data(data={\"error\": error_message})\n\n        except (NameError, TypeError, ValueError) as e:\n            error_message = f\"Error during execution: {e!s}\"\n            self.log(error_message)\n            return Data(data={\"error\": error_message})\n\n    def build_output(self) -> Data:\n        data = self.flightpassenger\n        return data\n\n"},"database_name":{"_input_type":"MessageTextInput","advanced":false,"display_name":"DB Name","dynamic":false,"info":"This is the name of the database in PCAI","input_types":["Message"],"list":false,"list_add_label":"Add More","load_from_db":false,"name":"database_name","placeholder":"","required":false,"show":true,"title_case":false,"tool_mode":false,"trace_as_input":true,"trace_as_metadata":true,"type":"str","value":"fakecustomerinfo"},"global_imports":{"_input_type":"StrInput","advanced":true,"display_name":"Global Imports","dynamic":false,"info":"A comma-separated list of modules to import globally, e.g. 'math,numpy,pandas'.","list":false,"list_add_label":"Add More","load_from_db":false,"name":"global_imports","placeholder":"","required":true,"show":true,"title_case":false,"tool_mode":false,"trace_as_metadata":true,"type":"str","value":"math,pandas"},"schema_name":{"_input_type":"MessageTextInput","advanced":false,"display_name":"Schema Name","dynamic":false,"info":"This is the name of the schema for the database in PCAI","input_types":["Message"],"list":false,"list_add_label":"Add More","load_from_db":false,"name":"schema_name","placeholder":"","required":false,"show":true,"title_case":false,"tool_mode":false,"trace_as_input":true,"trace_as_metadata":true,"type":"str","value":"default"},"sql_query":{"_input_type":"MessageTextInput","advanced":false,"display_name":"SQL Query","dynamic":false,"info":"This is the SQL query which will be run on the specified database in PCAI. The columns to match are name and flight.","input_types":["Message"],"list":false,"list_add_label":"Add More","load_from_db":false,"name":"sql_query","placeholder":"","required":false,"show":true,"title_case":false,"tool_mode":true,"trace_as_input":true,"trace_as_metadata":true,"type":"str","value":"SELECT * FROM fakecustomerinfo WHERE name = 'John' AND flight = 'A105'"},"sql_query_code":{"_input_type":"CodeInput","advanced":true,"display_name":"SQL Code","dynamic":false,"info":"The SQL code to execute.","list":false,"list_add_label":"Add More","load_from_db":false,"name":"sql_query_code","placeholder":"","required":true,"show":true,"title_case":false,"tool_mode":false,"trace_as_input":true,"type":"code","value":"import requests\nimport time\nimport json\n\n# Presto server configuration\npresto_host = \"ezpresto-sts-mst-0.ezpresto-svc-hdl.ezpresto.svc.cluster.local\"\npresto_port = 8081\ncatalog = \"fakecustomerinfo\"\nschema = \"default\"\ntable = \"fake_customer_data\"\n\n# Query to execute  \nsql_query = \"SELECT * FROM fake_customer_data\"\n\n\nauth_token = \"\"\n\n# Headers\nheaders = {\n    \"X-Presto-User\": \"user\",\n    \"X-Presto-Catalog\": catalog,\n    \"X-Presto-Schema\": schema,\n    \"Content-Type\": \"application/json\",\n    \"Authorization\": f\"Bearer {auth_token}\"\n}\n\n# Submit query\nresponse = requests.post(f\"https://{presto_host}:{presto_port}/v1/statement\", verify=False, headers=headers, data=sql_query)\n\nif response.status_code == 200:\n    data_result = {}\n    query_result = response.json()\n    \n    # Get next results if available\n    next_uri = query_result.get('nextUri')\n    while next_uri:\n        response = requests.get(next_uri, verify=False, headers=headers)\n        query_result = response.json()\n        \n        # Process results\n        if 'data' in query_result and query_result['data']:\n            data_columns = [k['name'] for k in query_result['columns']]\n            for n, results in enumerate(query_result['data']):\n                data_result[n] = {column: result for column, result in zip(data_columns, results)}\n        \n        # Update next URL or exit loop if done\n        next_uri = query_result.get('nextUri')\n        if not next_uri:\n            break\n        \n        # Optional: Add a small delay to avoid hammering the server\n        time.sleep(0.1)\n    \n    print(data_result)\nelse:\n    print(f\"Error: {response.status_code}, {response.text}\")"},"table_name":{"_input_type":"MessageTextInput","advanced":false,"display_name":"Table Name","dynamic":false,"info":"This is the name of the table within the schema for the database in PCAI","input_types":["Message"],"list":false,"list_add_label":"Add More","load_from_db":false,"name":"table_name","placeholder":"","required":false,"show":true,"title_case":false,"tool_mode":false,"trace_as_input":true,"trace_as_metadata":true,"type":"str","value":"fake_customer_data"},"tools_metadata":{"tool_mode":false,"trace_as_metadata":true,"is_list":true,"list_add_label":"Add More","required":false,"placeholder":"","show":true,"name":"tools_metadata","value":[{"args":{"sql_query":{"default":"SELECT * FROM fake_customer_data","description":"This is the SQL query which will be run on the specified database in PCAI. The columns to match are name and flight.","title":"Sql Query","type":"string"}},"description":"flightpassenger. flightpassenger - Use this tool to look up passenger flight information. The possible columns to match are name and/or flight if provided.","display_description":"flightpassenger. flightpassenger - Use this tool to look up passenger flight information. The possible columns to match are name and/or flight if provided.","display_name":"flightpassenger","name":"flightpassenger","readonly":false,"status":true,"tags":["flightpassenger"]}],"display_name":"Actions","advanced":false,"dynamic":false,"info":"Modify tool names and descriptions to help agents understand when to use each tool.","real_time_refresh":true,"title_case":false,"type":"tools","_input_type":"ToolsInput"},"user_password":{"_input_type":"SecretStrInput","advanced":false,"display_name":"User Token","dynamic":false,"info":"The user token to authorize the SQL query.","input_types":[],"load_from_db":true,"name":"user_password","password":true,"placeholder":"","required":true,"show":true,"title_case":false,"type":"str","value":"USER_TOKEN"}},"tool_mode":true},"showNode":true,"type":"flightpassenger"},"id":"flightpassenger-dhFpE","position":{"x":0,"y":0},"type":"genericNode"}],"viewport":{"x":1,"y":1,"zoom":1}},"description":"Use this tool to look up passenger flight information. The possible columns to match are name and/or flight if provided.","name":"EzPresto tool","id":"flightpassenger-dhFpE","is_component":true,"last_tested_version":"1.5.1"}